jQuery(document).ready(function(){'use strict';var basePreferenceURL='https://myibd.'+ window.envURL+'/Services/JSONPService.asmx/',playerSelector='myVidShortcode',videoSelector='.shortcode-video';jQuery(document).on('click','.close-mini-vid',function(){jQuery('.player-minimize').addClass('revert-minivid');});jQuery(document).ready(setTimeout(function(){var component={},videoTop=jQuery(videoSelector).attr('vid-top');component.autoStart=true;component.mute=true;component.autoStartValue=1;component.nonAutoStartValue=0;component.getPreference=function(){jQuery.ajax(basePreferenceURL+'GetVideoPreference',{contentType:'application/json; charset=utf-8',method:'GET',dataType:'jsonp',timeout:5000}).done(function(result){if('undefined'!==typeof result.d&&component.nonAutoStartValue===parseInt(result.d,10)){component.autoStart=false;}
startPlayingVideo();}).fail(function(){startPlayingVideo();});};component.setAutoStartPreference=function(autoStart){var preference=autoStart?component.autoStartValue:component.nonAutoStartValue;if(!IBDMain.isUserLoggedIn()){return;}
jQuery.ajax(basePreferenceURL+'UpdateVideoPreference',{method:'POST',contentType:'application/json; charset=utf-8',dataType:'jsonp',data:{preference:preference}});};component.init=function(){if(IBDMain.isUserLoggedIn()){component.getPreference();}else{startPlayingVideo();}};component.init();if('true'===videoTop){var videoElement=document.querySelector('.video-player-container');jQuery('.video-player-container').remove();jQuery('article.post header h1').after(videoElement);}
function getElementOffsetTop(el){var boundingClientRect=el.getBoundingClientRect();var bodyEl=document.body;var docEl=document.documentElement;var scrollTop=window.pageYOffset||docEl.scrollTop||bodyEl.scrollTop;var clientTop=docEl.clientTop||bodyEl.clientTop||0;return Math.round(boundingClientRect.top+ scrollTop- clientTop);}
function getScrollTop(){var docEl=document.documentElement;return(window.pageYOffset||docEl.scrollTop)-(docEl.clientTop||0);}
function startPlayingVideo(){var videoContainer=jQuery(videoSelector);var videoTitle=videoContainer.attr('vid-name');var videoURL=jQuery(videoSelector).attr('vid-url');var videoCat=videoContainer.attr('vid-cat');var videoDate=videoContainer.attr('vid-date');var vidId=videoContainer.attr('vid-id');var vidImage=videoContainer.attr('vid-image');var vidAuthors=videoContainer.attr('vid-authors');var video25sent=false;var video50sent=false;var video75sent=false;var playerInstance=jwplayer(playerSelector);var jwvidcon=document.querySelector(videoSelector);var adObject='';var adUrl=GetArticleMediaCenterAdURL();if(0===videoContainer.length){return;}
if('undefined'!==typeof digitalData&&'undefined'===typeof adUpgrade){digitalData.videoName=videoTitle+' - Embedded Video';digitalData.videoCategory=videoCat;digitalData.videoPublishDate=videoDate;digitalData.videoAuthors=vidAuthors;}
adObject={client:'googima',tag:adUrl,};if(!playerInstance.hasOwnProperty('setup')){return;}
playerInstance.setup({file:videoURL,width:'100%',aspectratio:'16:9',skin:'bekle',advertising:adObject,autostart:component.autoStart,mute:component.mute,image:vidImage,visualplaylist:false,repeat:'false'}).on('play',function(event){if('undefined'!==typeof playerInstance.getConfig().duration){digitalData.videoLength=Math.round(playerInstance.getConfig().duration);}
if('undefined'!==event&&'paused'===event.oldstate){_satellite.track('resumeplay');}
window.videosClickable=true;component.setAutoStartPreference(true);}).on('firstFrame',function(e){video25sent=false;video50sent=false;video75sent=false;try{_satellite.track('videostart');}catch(d){console.log('DTM Error');}}).on('ready',function(){var playerContainer=jQuery('.video-player-container');var playerContainerEl=document.querySelector('.video-player-container ');var utils=playerInstance.utils;playerContainer.show();var playerOffsetTop=getElementOffsetTop(playerContainerEl);playerContainer.css({'display':'inline-block'});function onScrollViewHandler(){var minimize=getScrollTop()>=playerOffsetTop;utils.toggleClass(jwvidcon,'player-minimize',minimize);if(getScrollTop()<=playerOffsetTop){jQuery(videoSelector).removeClass('revert-minivid');}
playerInstance.resize();}
var isScrollTimeout=false;window.onscroll=function(){if(isScrollTimeout){return;}
isScrollTimeout=true;onScrollViewHandler();setTimeout(function(){isScrollTimeout=false;},80);};}).on('time',function(e){try{if(!video25sent&&(playerInstance.getPosition()/ playerInstance.getDuration()
)>0.25){video25sent=true;_satellite.track('video25');jQuery.post(ajaxurl,{'action':'add_vid_to_watched_cookie','cvid':vidId,'nonce':'ibd-video-watched-cookie',},function(response){console.log('vid: '+ response);});}
if(!video50sent&&(playerInstance.getPosition()/ playerInstance.getDuration()
)>0.5){video50sent=true;_satellite.track('video50');}
if(!video75sent&&(playerInstance.getPosition()/ playerInstance.getDuration()
)>0.75){video75sent=true;_satellite.track('video75');}}catch(d){console.log('DTM Error: '+ d);}}).on('beforeComplete',function(event){try{_satellite.track('videocomplete');}catch(e){console.log('DTM Error');}
var viewTime=playerInstance.getPosition();var pauseUrl=jQuery(this).data('vid-end');viewTime=Math.round(viewTime);if(pauseUrl){pauseUrl=pauseUrl.replace('[time]',viewTime);var img=jQuery('<img id=\"vidpause-pixel\">');img.attr('src',pauseUrl);img.appendTo('body');}}).on('mute',function(event){if('undefined'!==typeof event&&true===event.mute){_satellite.track('volumemute');}else{_satellite.track('volumeunmuted');component.setAutoStartPreference(false);}}).on('pause',function(e){_satellite.track('pause');var viewTime=playerInstance.getPosition();console.log('viewTime');console.log(viewTime);viewTime=Math.round(viewTime);component.setAutoStartPreference(false);}).on('adPlay',function(){_satellite.track('prerollstart');component.setAutoStartPreference(true);}).on('adPause',function(){component.setAutoStartPreference(false);}).on('adComplete',function(){_satellite.track('prerollend');});}},2000));});